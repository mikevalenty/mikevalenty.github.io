<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Migraine Log</title><style>/*! tailwindcss v4.1.7 | MIT License | https://tailwindcss.com */
@layer properties{@supports (((-webkit-hyphens:none)) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:before,:after,::backdrop{--tw-rotate-x:initial;--tw-rotate-y:initial;--tw-rotate-z:initial;--tw-skew-x:initial;--tw-skew-y:initial;--tw-space-y-reverse:0;--tw-space-x-reverse:0;--tw-border-style:solid;--tw-leading:initial;--tw-font-weight:initial;--tw-shadow:0 0 #0000;--tw-shadow-color:initial;--tw-shadow-alpha:100%;--tw-inset-shadow:0 0 #0000;--tw-inset-shadow-color:initial;--tw-inset-shadow-alpha:100%;--tw-ring-color:initial;--tw-ring-shadow:0 0 #0000;--tw-inset-ring-color:initial;--tw-inset-ring-shadow:0 0 #0000;--tw-ring-inset:initial;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-offset-shadow:0 0 #0000;--tw-outline-style:solid;--tw-duration:initial;--tw-ease:initial}}}@layer theme{:root,:host{--font-sans:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--color-red-50:oklch(97.1% .013 17.38);--color-red-100:oklch(93.6% .032 17.717);--color-red-300:oklch(80.8% .114 19.571);--color-red-500:oklch(63.7% .237 25.331);--color-red-600:oklch(57.7% .245 27.325);--color-red-700:oklch(50.5% .213 27.518);--color-green-500:oklch(72.3% .219 149.579);--color-green-600:oklch(62.7% .194 149.214);--color-green-700:oklch(52.7% .154 150.069);--color-blue-50:oklch(97% .014 254.604);--color-blue-500:oklch(62.3% .214 259.815);--color-indigo-500:oklch(58.5% .233 277.117);--color-indigo-600:oklch(51.1% .262 276.966);--color-indigo-700:oklch(45.7% .24 277.023);--color-gray-50:oklch(98.5% .002 247.839);--color-gray-100:oklch(96.7% .003 264.542);--color-gray-200:oklch(92.8% .006 264.531);--color-gray-300:oklch(87.2% .01 258.338);--color-gray-400:oklch(70.7% .022 261.325);--color-gray-500:oklch(55.1% .027 264.364);--color-gray-600:oklch(44.6% .03 256.802);--color-gray-700:oklch(37.3% .034 259.733);--color-gray-800:oklch(27.8% .033 256.848);--color-gray-900:oklch(21% .034 264.665);--color-white:#fff;--spacing:.25rem;--container-md:28rem;--container-lg:32rem;--text-xs:.75rem;--text-xs--line-height:calc(1/.75);--text-sm:.875rem;--text-sm--line-height:calc(1.25/.875);--text-base:1rem;--text-base--line-height:calc(1.5/1);--text-lg:1.125rem;--text-lg--line-height:calc(1.75/1.125);--text-xl:1.25rem;--text-xl--line-height:calc(1.75/1.25);--text-2xl:1.5rem;--text-2xl--line-height:calc(2/1.5);--text-3xl:1.875rem;--text-3xl--line-height:calc(2.25/1.875);--font-weight-medium:500;--font-weight-semibold:600;--font-weight-bold:700;--radius-md:.375rem;--radius-lg:.5rem;--ease-in-out:cubic-bezier(.4,0,.2,1);--default-transition-duration:.15s;--default-transition-timing-function:cubic-bezier(.4,0,.2,1);--default-font-family:var(--font-sans);--default-mono-font-family:var(--font-mono)}}@layer base{*,:after,:before,::backdrop{box-sizing:border-box;border:0 solid;margin:0;padding:0}::file-selector-button{box-sizing:border-box;border:0 solid;margin:0;padding:0}html,:host{-webkit-text-size-adjust:100%;tab-size:4;line-height:1.5;font-family:var(--default-font-family,ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji");font-feature-settings:var(--default-font-feature-settings,normal);font-variation-settings:var(--default-font-variation-settings,normal);-webkit-tap-highlight-color:transparent}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:var(--default-mono-font-family,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace);font-feature-settings:var(--default-mono-font-feature-settings,normal);font-variation-settings:var(--default-mono-font-variation-settings,normal);font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}:-moz-focusring{outline:auto}progress{vertical-align:baseline}summary{display:list-item}ol,ul,menu{list-style:none}img,svg,video,canvas,audio,iframe,embed,object{vertical-align:middle;display:block}img,video{max-width:100%;height:auto}button,input,select,optgroup,textarea{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;opacity:1;background-color:#0000;border-radius:0}::file-selector-button{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;opacity:1;background-color:#0000;border-radius:0}:where(select:is([multiple],[size])) optgroup{font-weight:bolder}:where(select:is([multiple],[size])) optgroup option{padding-inline-start:20px}::file-selector-button{margin-inline-end:4px}::placeholder{opacity:1}@supports (not ((-webkit-appearance:-apple-pay-button))) or (contain-intrinsic-size:1px){::placeholder{color:currentColor;@supports (color:color-mix(in lab, red, red)){color:color-mix(in oklab,currentcolor 50%,transparent)}}}textarea{resize:vertical}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-date-and-time-value{min-height:1lh;text-align:inherit}::-webkit-datetime-edit{display:inline-flex}::-webkit-datetime-edit-fields-wrapper{padding:0}::-webkit-datetime-edit{padding-block:0}::-webkit-datetime-edit-year-field{padding-block:0}::-webkit-datetime-edit-month-field{padding-block:0}::-webkit-datetime-edit-day-field{padding-block:0}::-webkit-datetime-edit-hour-field{padding-block:0}::-webkit-datetime-edit-minute-field{padding-block:0}::-webkit-datetime-edit-second-field{padding-block:0}::-webkit-datetime-edit-millisecond-field{padding-block:0}::-webkit-datetime-edit-meridiem-field{padding-block:0}:-moz-ui-invalid{box-shadow:none}button,input:where([type=button],[type=reset],[type=submit]){appearance:button}::file-selector-button{appearance:button}::-webkit-inner-spin-button{height:auto}::-webkit-outer-spin-button{height:auto}[hidden]:where(:not([hidden=until-found])){display:none!important}}@layer components;@layer utilities{.visible{visibility:visible}.absolute{position:absolute}.fixed{position:fixed}.relative{position:relative}.inset-0{inset:calc(var(--spacing)*0)}.right-0{right:calc(var(--spacing)*0)}.bottom-0{bottom:calc(var(--spacing)*0)}.left-0{left:calc(var(--spacing)*0)}.z-10{z-index:10}.z-50{z-index:50}.col-span-7{grid-column:span 7/span 7}.container{width:100%;@media (width>=40rem){max-width:40rem}@media (width>=48rem){max-width:48rem}@media (width>=64rem){max-width:64rem}@media (width>=80rem){max-width:80rem}@media (width>=96rem){max-width:96rem}}.mx-auto{margin-inline:auto}.mt-1{margin-top:calc(var(--spacing)*1)}.mt-2{margin-top:calc(var(--spacing)*2)}.mt-3{margin-top:calc(var(--spacing)*3)}.mt-6{margin-top:calc(var(--spacing)*6)}.mt-8{margin-top:calc(var(--spacing)*8)}.mr-2{margin-right:calc(var(--spacing)*2)}.mb-1{margin-bottom:calc(var(--spacing)*1)}.mb-2{margin-bottom:calc(var(--spacing)*2)}.mb-3{margin-bottom:calc(var(--spacing)*3)}.mb-4{margin-bottom:calc(var(--spacing)*4)}.ml-2{margin-left:calc(var(--spacing)*2)}.block{display:block}.contents{display:contents}.flex{display:flex}.grid{display:grid}.hidden{display:none}.inline-flex{display:inline-flex}.h-4{height:calc(var(--spacing)*4)}.h-5{height:calc(var(--spacing)*5)}.h-6{height:calc(var(--spacing)*6)}.h-12{height:calc(var(--spacing)*12)}.h-16{height:calc(var(--spacing)*16)}.h-64{height:calc(var(--spacing)*64)}.h-full{height:100%}.min-h-screen{min-height:100vh}.w-5{width:calc(var(--spacing)*5)}.w-6{width:calc(var(--spacing)*6)}.w-11\/12{width:91.6667%}.w-12{width:calc(var(--spacing)*12)}.w-full{width:100%}.max-w-lg{max-width:var(--container-lg)}.max-w-md{max-width:var(--container-md)}.flex-shrink-0{flex-shrink:0}.flex-grow{flex-grow:1}.transform{transform:var(--tw-rotate-x, )var(--tw-rotate-y, )var(--tw-rotate-z, )var(--tw-skew-x, )var(--tw-skew-y, )}.cursor-default{cursor:default}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.flex-col{flex-direction:column}.items-center{align-items:center}.items-start{align-items:flex-start}.justify-around{justify-content:space-around}.justify-between{justify-content:space-between}.justify-center{justify-content:center}.gap-4{gap:calc(var(--spacing)*4)}.space-y-3{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*3)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*3)*calc(1 - var(--tw-space-y-reverse)))}}.space-y-4{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*4)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*4)*calc(1 - var(--tw-space-y-reverse)))}}.space-y-6{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*6)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*6)*calc(1 - var(--tw-space-y-reverse)))}}.space-x-2{:where(&>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing)*2)*var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing)*2)*calc(1 - var(--tw-space-x-reverse)))}}.overflow-y-auto{overflow-y:auto}.rounded{border-radius:.25rem}.rounded-full{border-radius:3.40282e38px}.rounded-lg{border-radius:var(--radius-lg)}.rounded-md{border-radius:var(--radius-md)}.border{border-style:var(--tw-border-style);border-width:1px}.border-2{border-style:var(--tw-border-style);border-width:2px}.border-t{border-top-style:var(--tw-border-style);border-top-width:1px}.border-blue-500{border-color:var(--color-blue-500)}.border-gray-100{border-color:var(--color-gray-100)}.border-gray-200{border-color:var(--color-gray-200)}.border-gray-300{border-color:var(--color-gray-300)}.border-indigo-500{border-color:var(--color-indigo-500)}.border-red-300{border-color:var(--color-red-300)}.border-transparent{border-color:#0000}.bg-blue-50{background-color:var(--color-blue-50)}.bg-gray-50{background-color:var(--color-gray-50)}.bg-gray-100{background-color:var(--color-gray-100)}.bg-gray-600{background-color:var(--color-gray-600)}.bg-green-600{background-color:var(--color-green-600)}.bg-indigo-600{background-color:var(--color-indigo-600)}.bg-red-100{background-color:var(--color-red-100)}.bg-red-500{background-color:var(--color-red-500)}.bg-white{background-color:var(--color-white)}.p-2{padding:calc(var(--spacing)*2)}.p-3{padding:calc(var(--spacing)*3)}.p-4{padding:calc(var(--spacing)*4)}.p-5{padding:calc(var(--spacing)*5)}.p-6{padding:calc(var(--spacing)*6)}.px-3{padding-inline:calc(var(--spacing)*3)}.px-4{padding-inline:calc(var(--spacing)*4)}.px-7{padding-inline:calc(var(--spacing)*7)}.py-1{padding-block:calc(var(--spacing)*1)}.py-2{padding-block:calc(var(--spacing)*2)}.py-3{padding-block:calc(var(--spacing)*3)}.py-4{padding-block:calc(var(--spacing)*4)}.pt-2{padding-top:calc(var(--spacing)*2)}.pb-1{padding-bottom:calc(var(--spacing)*1)}.pb-16{padding-bottom:calc(var(--spacing)*16)}.text-center{text-align:center}.text-2xl{font-size:var(--text-2xl);line-height:var(--tw-leading,var(--text-2xl--line-height))}.text-3xl{font-size:var(--text-3xl);line-height:var(--tw-leading,var(--text-3xl--line-height))}.text-base{font-size:var(--text-base);line-height:var(--tw-leading,var(--text-base--line-height))}.text-lg{font-size:var(--text-lg);line-height:var(--tw-leading,var(--text-lg--line-height))}.text-sm{font-size:var(--text-sm);line-height:var(--tw-leading,var(--text-sm--line-height))}.text-xl{font-size:var(--text-xl);line-height:var(--tw-leading,var(--text-xl--line-height))}.text-xs{font-size:var(--text-xs);line-height:var(--tw-leading,var(--text-xs--line-height))}.leading-6{--tw-leading:calc(var(--spacing)*6);line-height:calc(var(--spacing)*6)}.font-bold{--tw-font-weight:var(--font-weight-bold);font-weight:var(--font-weight-bold)}.font-medium{--tw-font-weight:var(--font-weight-medium);font-weight:var(--font-weight-medium)}.font-semibold{--tw-font-weight:var(--font-weight-semibold);font-weight:var(--font-weight-semibold)}.whitespace-pre-wrap{white-space:pre-wrap}.text-gray-400{color:var(--color-gray-400)}.text-gray-500{color:var(--color-gray-500)}.text-gray-600{color:var(--color-gray-600)}.text-gray-700{color:var(--color-gray-700)}.text-gray-800{color:var(--color-gray-800)}.text-gray-900{color:var(--color-gray-900)}.text-green-600{color:var(--color-green-600)}.text-indigo-600{color:var(--color-indigo-600)}.text-red-500{color:var(--color-red-500)}.text-red-600{color:var(--color-red-600)}.text-red-700{color:var(--color-red-700)}.text-white{color:var(--color-white)}.italic{font-style:italic}.opacity-50{opacity:.5}.shadow{--tw-shadow:0 1px 3px 0 var(--tw-shadow-color,#0000001a),0 1px 2px -1px var(--tw-shadow-color,#0000001a);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px var(--tw-shadow-color,#0000001a),0 4px 6px -4px var(--tw-shadow-color,#0000001a);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px var(--tw-shadow-color,#0000001a),0 2px 4px -2px var(--tw-shadow-color,#0000001a);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 3px 0 var(--tw-shadow-color,#0000001a),0 1px 2px -1px var(--tw-shadow-color,#0000001a);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring-indigo-500{--tw-ring-color:var(--color-indigo-500)}.outline{outline-style:var(--tw-outline-style);outline-width:1px}.transition{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to,opacity,box-shadow,transform,translate,scale,rotate,filter,backdrop-filter,display,visibility,content-visibility,overlay,pointer-events;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.duration-150{--tw-duration:.15s;transition-duration:.15s}.ease-in-out{--tw-ease:var(--ease-in-out);transition-timing-function:var(--ease-in-out)}.group-hover\:text-gray-700{&:is(:where(.group):hover *){@media (hover:hover){color:var(--color-gray-700)}}}.hover\:bg-blue-50{&:hover{@media (hover:hover){background-color:var(--color-blue-50)}}}.hover\:bg-gray-50{&:hover{@media (hover:hover){background-color:var(--color-gray-50)}}}.hover\:bg-gray-100{&:hover{@media (hover:hover){background-color:var(--color-gray-100)}}}.hover\:bg-green-700{&:hover{@media (hover:hover){background-color:var(--color-green-700)}}}.hover\:bg-indigo-700{&:hover{@media (hover:hover){background-color:var(--color-indigo-700)}}}.hover\:bg-red-50{&:hover{@media (hover:hover){background-color:var(--color-red-50)}}}.hover\:bg-red-600{&:hover{@media (hover:hover){background-color:var(--color-red-600)}}}.hover\:text-indigo-600{&:hover{@media (hover:hover){color:var(--color-indigo-600)}}}.focus\:border-indigo-500{&:focus{border-color:var(--color-indigo-500)}}.focus\:ring-2{&:focus{--tw-ring-shadow:var(--tw-ring-inset, )0 0 0 calc(2px + var(--tw-ring-offset-width))var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.focus\:ring-green-500{&:focus{--tw-ring-color:var(--color-green-500)}}.focus\:ring-indigo-500{&:focus{--tw-ring-color:var(--color-indigo-500)}}.focus\:ring-red-300{&:focus{--tw-ring-color:var(--color-red-300)}}.focus\:ring-red-500{&:focus{--tw-ring-color:var(--color-red-500)}}.focus\:ring-offset-2{&:focus{--tw-ring-offset-width:2px;--tw-ring-offset-shadow:var(--tw-ring-inset, )0 0 0 var(--tw-ring-offset-width)var(--tw-ring-offset-color)}}.focus\:outline-none{&:focus{--tw-outline-style:none;outline-style:none}}.disabled\:opacity-50{&:disabled{opacity:.5}}.sm\:h-72{@media (width>=40rem){height:calc(var(--spacing)*72)}}.sm\:p-6{@media (width>=40rem){padding:calc(var(--spacing)*6)}}.md\:h-80{@media (width>=48rem){height:calc(var(--spacing)*80)}}}@property --tw-rotate-x{syntax:"*";inherits:false}@property --tw-rotate-y{syntax:"*";inherits:false}@property --tw-rotate-z{syntax:"*";inherits:false}@property --tw-skew-x{syntax:"*";inherits:false}@property --tw-skew-y{syntax:"*";inherits:false}@property --tw-space-y-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-space-x-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-leading{syntax:"*";inherits:false}@property --tw-font-weight{syntax:"*";inherits:false}@property --tw-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-shadow-color{syntax:"*";inherits:false}@property --tw-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-inset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-shadow-color{syntax:"*";inherits:false}@property --tw-inset-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-ring-color{syntax:"*";inherits:false}@property --tw-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-ring-color{syntax:"*";inherits:false}@property --tw-inset-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-ring-inset{syntax:"*";inherits:false}@property --tw-ring-offset-width{syntax:"<length>";inherits:false;initial-value:0}@property --tw-ring-offset-color{syntax:"*";inherits:false;initial-value:#fff}@property --tw-ring-offset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-outline-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-duration{syntax:"*";inherits:false}@property --tw-ease{syntax:"*";inherits:false}
/*# sourceMappingURL=migraine-log.be2fed08.css.map */
</style><style>body{overscroll-behavior-y:contain;font-family:Inter,sans-serif}button,[role=button],a,.clickable,.cursor-pointer,input[type=submit],input[type=button]{cursor:pointer}button:disabled,[role=button]:disabled,input[type=submit]:disabled,input[type=button]:disabled{opacity:.6;pointer-events:none;cursor:not-allowed!important}.scrollable-content::-webkit-scrollbar{display:none}.scrollable-content{-ms-overflow-style:none;scrollbar-width:none}.nav-active svg,.nav-active span{color:#4f46e5;font-weight:600}input:focus,textarea:focus{outline-offset:2px;border-color:#6366f1;outline:2px solid #0000;box-shadow:0 0 0 2px #4f46e5}.calendar-grid{grid-template-columns:repeat(7,1fr);gap:4px;display:grid}.calendar-day,.calendar-header-day{border-radius:4px;justify-content:center;align-items:center;height:40px;display:flex}.calendar-header-day{color:#6b7280;white-space:nowrap;font-size:.8rem;font-weight:600}.calendar-day{cursor:default;font-size:.9rem;position:relative}.calendar-day.other-month{color:#d1d5db}.calendar-day.has-migraine:after{content:"";background-color:#ef4444;border-radius:50%;width:6px;height:6px;position:absolute;bottom:4px;left:50%;transform:translate(-50%)}.calendar-day.today{background-color:#e0e7ff;font-weight:700}</style><script defer>class MigraineStore{async getEntries(){throw Error("getEntries must be implemented")}async createEntry(e){throw Error("createEntry must be implemented")}async updateEntry(e,t){throw Error("updateEntry must be implemented")}async deleteEntry(e){throw Error("deleteEntry must be implemented")}}class LocalStorageMigraineStore extends MigraineStore{constructor(){super(),this.storageKey="migraineEntries",this.nextIdKey="migraineNextId"}async getEntries(){let e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):[]}async createEntry(e){let t=await this.getEntries(),r=this._getNextId(),a={...e,rowId:r};return t.push(a),localStorage.setItem(this.storageKey,JSON.stringify(t)),this._incrementNextId(),a}async updateEntry(e,t){let r=await this.getEntries(),a=r.findIndex(t=>t.rowId===e);if(-1===a)throw Error(`Entry with rowId ${e} not found`);let s={...t,rowId:e};return r[a]=s,localStorage.setItem(this.storageKey,JSON.stringify(r)),s}async deleteEntry(e){let t=await this.getEntries(),r=t.filter(t=>t.rowId!==e);if(r.length===t.length)throw Error(`Entry with rowId ${e} not found`);localStorage.setItem(this.storageKey,JSON.stringify(r))}_getNextId(){let e=localStorage.getItem(this.nextIdKey);return e?parseInt(e,10):1}_incrementNextId(){let e=this._getNextId()+1;localStorage.setItem(this.nextIdKey,e.toString())}}class AppSheetMigraineStore extends MigraineStore{constructor(e){super(),this.scriptUrl=e}async getEntries(){if(!this.scriptUrl)throw Error("Script URL not configured");let e=await fetch(this.scriptUrl,{method:"GET",mode:"cors"});if(!e.ok){let t=`HTTP error! status: ${e.status}`;try{t=(await e.json()).message||t}catch(e){}throw Error(t)}let t=await e.json();if("success"!==t.status)throw Error(t.message||"Failed to fetch data from script.");return t.data||[]}async createEntry(e){return this._sendRequest({action:"create",date:e.date,notes:e.notes})}async updateEntry(e,t){return this._sendRequest({action:"update",rowId:e,date:t.date,notes:t.notes})}async deleteEntry(e){await this._sendRequest({action:"delete",rowId:e})}async _sendRequest(e){if(!this.scriptUrl)throw Error("Script URL not configured");let t=await fetch(this.scriptUrl,{method:"POST",mode:"cors",headers:{"Content-Type":"text/plain"},body:JSON.stringify(e)}),r=await t.json();if(!t.ok||"success"!==r.status)throw Error(r.message||`HTTP error! Status: ${t.status}`);return r.data}}class GoogleSheetsMigraineStore extends MigraineStore{constructor(e,t="Sheet1",r){super(),this.spreadsheetId=e,this.sheetName=t,this.clientId=r,this.accessToken=null,this.isInitialized=!1,this.spreadsheetCreated=!1}async _ensureInitialized(){if(!this.isInitialized){if(!window.google?.accounts?.oauth2)throw Error("Google Identity Services not loaded");this.isInitialized=!0}}async _ensureAuthenticated(){if(await this._ensureInitialized(),!this.accessToken)return new Promise((e,t)=>{window.google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:"https://www.googleapis.com/auth/drive.file",callback:r=>{r.error?t(Error(r.error)):(this.accessToken=r.access_token,e())}}).requestAccessToken()})}async _makeRequest(e,t,r=null){await this._ensureAuthenticated();let a=`https://sheets.googleapis.com/v4/spreadsheets/${this.spreadsheetId}${t}`,s={method:e,headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}};r&&(s.body=JSON.stringify(r));let i=await fetch(a,s);if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error?.message||`HTTP ${i.status}: ${i.statusText}`)}return i.json()}async getEntries(){let e=`${this.sheetName}!A:C`,t=(await this._makeRequest("GET",`/values/${e}`)).values||[];return t.length<=1?[]:t.slice(1).map((e,t)=>({rowId:t+2,date:e[0]||"",notes:e[1]||""})).filter(e=>e.date)}async createEntry(e){let t=`${this.sheetName}!A:C`,r=[[e.date,e.notes,""]];return await this._makeRequest("POST",`/values/${t}:append?valueInputOption=RAW`,{values:r}),(await this.getEntries()).find(t=>t.date===e.date&&t.notes===e.notes)}async updateEntry(e,t){let r=`${this.sheetName}!A${e}:B${e}`,a=[[t.date,t.notes]];return await this._makeRequest("PUT",`/values/${r}?valueInputOption=RAW`,{values:a}),{...t,rowId:e}}async deleteEntry(e){let t=`${this.sheetName}!A${e}:C${e}`;await this._makeRequest("PUT",`/values/${t}?valueInputOption=RAW`,{values:[["","",""]]})}async signOut(){this.accessToken&&window.google.accounts.oauth2.revoke(this.accessToken),this.accessToken=null}isSignedIn(){return!!this.accessToken}}class CachingMigraineStore extends MigraineStore{constructor(e,t,r=10){super(),this.sourceStore=e,this.cacheStore=t,this.ttlMs=6e4*r,this.lastFetchKey="migraineLastFetch"}async getEntries(){let e=localStorage.getItem(this.lastFetchKey),t=Date.now();if(e){let r=t-parseInt(e,10);if(r<this.ttlMs)return console.log(`Using cached data (${Math.round(r/1e3)} seconds old)`),this.cacheStore.getEntries()}console.log("Fetching fresh data from source...");let r=await this.sourceStore.getEntries();return await this._updateCache(r),localStorage.setItem(this.lastFetchKey,t.toString()),r}async createEntry(e){let t=await this.sourceStore.createEntry(e);return this._invalidateCache(),t}async updateEntry(e,t){let r=await this.sourceStore.updateEntry(e,t);return this._invalidateCache(),r}async deleteEntry(e){await this.sourceStore.deleteEntry(e),this._invalidateCache()}async _updateCache(e){for(let e of(await this.cacheStore.getEntries()))await this.cacheStore.deleteEntry(e.rowId);for(let t of e)await this.cacheStore.createEntry({date:t.date,notes:t.notes})}_invalidateCache(){localStorage.removeItem(this.lastFetchKey)}}class MigraineApp{constructor(e){this.store=e,this.migraineData=new Map,this.editingEntryId=null,this.historyDataCache=[]}processMigraineEntries(e){console.log("Processing migraine entries:",e.length,"items"),this.migraineData.clear(),e.forEach(e=>{let{date:t}=e;if(t){let r=new Date(t),a=r.getFullYear(),s=r.getMonth()+1,i=r.getDate(),n=`${a}-${String(s).padStart(2,"0")}-${String(i).padStart(2,"0")}`;this.migraineData.has(n)||this.migraineData.set(n,[]),this.migraineData.get(n).push({date:e.date,notes:e.notes||"",rowId:e.rowId})}else console.error("Entry missing date field:",e)}),console.log("Finished processing. migraineData map now has",this.migraineData.size,"unique dates")}async fetchAndProcessEntries(){let e=await this.store.getEntries();return this.processMigraineEntries(e),this.historyDataCache=e,e}async createEntry(e,t){let r=await this.store.createEntry({date:e,notes:t});return await this.fetchAndProcessEntries(),r}async updateEntry(e,t,r){let a=await this.store.updateEntry(e,{date:t,notes:r});return await this.fetchAndProcessEntries(),a}async deleteEntry(e){await this.store.deleteEntry(e),await this.fetchAndProcessEntries()}calculateDaysSinceLastMigraine(){if(0===this.historyDataCache.length)return null;let e=new Date([...this.historyDataCache].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())[0].date),t=new Date,r=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(t.getFullYear(),t.getMonth(),t.getDate());return r<=a?Math.floor((a.getTime()-r.getTime())/864e5):0}clearCache(){this.store&&"function"==typeof this.store._invalidateCache&&this.store._invalidateCache()}async refreshFromSource(){return this.clearCache(),await this.fetchAndProcessEntries()}}"undefined"!=typeof module&&module.exports&&(module.exports={MigraineStore,LocalStorageMigraineStore,AppSheetMigraineStore,GoogleSheetsMigraineStore,CachingMigraineStore,MigraineApp}),"undefined"!=typeof window&&(window.MigraineStore=MigraineStore,window.LocalStorageMigraineStore=LocalStorageMigraineStore,window.AppSheetMigraineStore=AppSheetMigraineStore,window.GoogleSheetsMigraineStore=GoogleSheetsMigraineStore,window.CachingMigraineStore=CachingMigraineStore,window.MigraineApp=MigraineApp);
//# sourceMappingURL=migraine-log.f063ccc6.js.map
</script><script defer>document.addEventListener("DOMContentLoaded",()=>{let e,t="migraineLogScriptUrl",n="migraineLogStorageType",r="migraineLogSheetsConfig",a=localStorage.getItem(t)||"",o=localStorage.getItem(n)||"local",i=JSON.parse(localStorage.getItem(r)||"{}");function l(){let t=!!window.google?.accounts?.oauth2;e="appsheet"===o&&a?new MigraineApp(new CachingMigraineStore(new AppSheetMigraineStore(a),new LocalStorageMigraineStore,10)):t&&"sheets"===o&&i.clientId&&i.spreadsheetId?new MigraineApp(new CachingMigraineStore(new GoogleSheetsMigraineStore(i.spreadsheetId,i.sheetName||"Sheet1",i.clientId),new LocalStorageMigraineStore,10)):new MigraineApp(new LocalStorageMigraineStore),window.migraineApp=e}window.migraineApp=null,l();let s=document.getElementById("migraine-form");document.getElementById("migraine-history-body"),document.getElementById("delete-confirm-modal"),document.getElementById("migraine-table");let d=document.getElementById("last-updated"),c=document.getElementById("script-url"),g=document.getElementById("save-appsheet-button"),u=document.getElementById("appsheet-status"),m=document.querySelectorAll('input[name="storage-type"]'),h=document.getElementById("appsheet-config"),y=document.getElementById("sheets-config"),p=document.getElementById("spreadsheet-id"),f=document.getElementById("sheet-name"),v=document.getElementById("save-sheets-button"),b=document.getElementById("signout-sheets-button"),E=document.getElementById("sheets-status"),w=document.getElementById("migraine-datetime"),L=document.getElementById("notes"),x=document.getElementById("save-entry-button"),S=document.getElementById("cancel-edit-button"),I=document.getElementById("history-content"),C=document.getElementById("refresh-history-button"),D=document.getElementById("days-since-last-migraine"),M=document.getElementById("log-view"),B=document.getElementById("calendar-view"),k=document.getElementById("settings-view"),A=document.getElementById("report-view"),$=document.getElementById("log-nav-button"),T=document.getElementById("calendar-nav-button"),N=document.getElementById("settings-nav-button"),F=document.getElementById("report-nav-button"),z=null,H=document.getElementById("prev-month"),O=document.getElementById("next-month"),R=document.getElementById("current-month-year"),j=document.getElementById("first-month-year"),W=document.getElementById("second-month-year"),P=document.getElementById("third-month-year"),Y=document.getElementById("calendar-grid-1"),J=document.getElementById("calendar-grid-2"),U=document.getElementById("calendar-grid-3"),q=new Date().getFullYear(),Z=new Date().getMonth(),G=null,_=null,K=null,Q=document.getElementById("error-modal"),V=document.getElementById("error-message"),X=document.getElementById("close-error-modal-button");function ee(e){V&&(V.textContent=e),Q&&Q.classList.remove("hidden")}function et(){if(D&&e)try{let t=e.calculateDaysSinceLastMigraine();D.textContent=null!==t?t:"--"}catch(e){console.error("Error calculating days since last migraine:",e),D.textContent="ERR"}}function en(){if(!d)return;let e=new Date,t=e.toLocaleDateString(void 0,{month:"numeric",day:"numeric",year:"numeric"}),n=e.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0});d.textContent=`Last updated: ${t} at ${n}`}function er(e,t,n=!1,r=3e3){e&&(e.textContent=t,e.className=`text-sm mt-1 h-4 ${n?"text-red-600":"text-green-600"}`,r>0&&setTimeout(()=>{e.textContent===t&&(e.textContent="",e.className="text-sm mt-1 h-4")},r))}function ea(t,n=!1,r=!1){let a,o,i=[M,B,k,A].filter(Boolean),l=[$,T,N,F].filter(Boolean);switch(i.forEach(e=>{e&&e.classList.add("hidden")}),t){case"calendar":a=B,o=T,a&&ef();break;case"settings":a=k,o=N;break;case"report":if(a=A,o=F,a){let t=document.getElementById("report-loading-message");t&&(t.textContent="Loading report data...",t.classList.remove("hidden")),console.log("Report view selected, fetching data..."),new Promise((e,t)=>{if("undefined"!=typeof Chart)return e();let n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/chart.js",n.async=!0,n.onload=()=>e(),n.onerror=()=>t(Error("Failed to load Chart.js")),document.head.appendChild(n)}).then(()=>{if(console.log("Chart.js loaded, now fetching migraine data..."),!e)throw Error("MigraineApp not initialized");return e.fetchAndProcessEntries()}).then(e=>{console.log("Data fetched for report view, entries:",e.length),e&&e.length>0?(ew(),ex(e),eL(e)):(ew(),ex([]),eL([]),t&&(t.textContent="No migraine data available to display reports.")),t&&t.classList.add("hidden")}).catch(e=>{console.error("Error preparing report view:",e),t&&(t.textContent="Error loading data. "+(e.message||""),t.classList.remove("hidden"))})}break;default:a=M,o=$,a&&!n&&r&&ei(r),et()}a&&a.classList.remove("hidden"),l.forEach(e=>{e===o?(e.classList.add("text-indigo-600"),e.classList.remove("text-gray-600")):(e.classList.remove("text-indigo-600"),e.classList.add("text-gray-600"))})}function eo(){if(!w)return;let e=new Date,t=6e4*e.getTimezoneOffset();w.value=new Date(e.getTime()-t).toISOString().slice(0,16)}async function ei(t=!1){if(!e){I&&(I.innerHTML='<p class="text-red-500 text-center">Error: App not initialized.</p>');return}if(I)try{let n=await e.fetchAndProcessEntries();ed(n),et(),t&&en()}catch(e){console.error("Error loading history:",e),ee(`Error loading history: ${e.message}`),I.innerHTML='<p class="text-red-500 text-center">Error loading history. Please check the script URL or network connection.</p>'}}async function el(){if(!e){I&&(I.innerHTML='<p class="text-red-500 text-center">Error: App not initialized.</p>');return}if(C&&I){C.disabled=!0,I.innerHTML='<p class="text-gray-500 text-center">Loading history...</p>';try{let t=await e.refreshFromSource();ed(t),et(),en()}catch(e){console.error("Error fetching history:",e),ee(`Error fetching history: ${e.message}`),I.innerHTML='<p class="text-red-500 text-center">Error loading history. Please check the script URL or network connection.</p>'}finally{C.disabled=!1,C.textContent="Refresh"}}}async function es(){return await el()}function ed(e){if(!I)return;if(!e||0===e.length){I.innerHTML='<p class="text-gray-500 text-center">No migraine entries logged yet.</p>';return}e.sort((e,t)=>new Date(t.date)-new Date(e.date));let t='<ul class="space-y-3">';e.forEach(e=>{let n=e.notes?e.notes.replace(/</g,"&lt;").replace(/>/g,"&gt;"):"",r=new Date(e.date),a=isNaN(r.getTime())?"Invalid Date":r.toLocaleString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),o=e.rowId,i=z&&z===o;t+=`
        <li class="group p-3 ${i?"border-2 border-blue-500 bg-blue-50":"border border-gray-200 bg-gray-50"} rounded-md flex justify-between items-start ${i?"shadow-md":"hover:bg-gray-100"} transition duration-150 ease-in-out" data-entry-id="${o}"${i?' data-edit-mode="true"':""}>
          <div>
             <p class="font-medium text-gray-700 text-sm mb-1">${a}</p>
             <p class="text-sm text-gray-400 whitespace-pre-wrap">${n||'<span class="italic text-gray-400">No notes</span>'}</p>
          </div>
          <div class="flex space-x-2 flex-shrink-0 ml-2">
              <button class="edit-btn text-gray-400 group-hover:text-gray-700 cursor-pointer transition duration-150 ease-in-out" data-id="${o}" title="Edit">
                 <svg class="w-5 h-5"><use xlink:href="#icon-edit"></use></svg>
              </button>
              <button class="delete-btn text-gray-400 group-hover:text-gray-700 cursor-pointer transition duration-150 ease-in-out" data-id="${o}" title="Delete">
                  <svg class="w-5 h-5"><use xlink:href="#icon-delete"></use></svg>
              </button>
          </div>
        </li>
      `}),I.innerHTML=t+="</ul>"}async function ec(t){if(console.log("Delete clicked for ID:",t),confirm("Are you sure you want to delete this entry?")){if(!e)return void ee("Error: App not initialized.");try{await e.deleteEntry(t),await es(),et(),en()}catch(e){console.error("Error deleting entry:",e),ee(`Error: ${e.message||"Could not delete entry."}`)}}}function eg(){s.reset(),z=null,x&&(x.textContent="New Entry"),S&&S.classList.add("hidden"),x&&(x.disabled=!1),eo(),es()}async function eu(t){if(t.preventDefault(),!e)return void ee("Error: App not initialized.");if(!x)return;let n=null!==z;x.disabled=!0,x.textContent=n?"Updating...":"Saving...";let r=w?w.value:"",a=L?L.value:"";try{n?await e.updateEntry(z,r,a):await e.createEntry(r,a),eg(),await es(),et(),en()}catch(e){console.error(`Error ${n?"updating":"creating"} entry:`,e),ee(`Error: ${e.message||`Could not ${n?"update":"create"} entry.`}`)}finally{x&&(x.disabled=!1)}}async function em(){if(!p)return;let t=p.value.trim(),a=f?.value.trim()||"Sheet1";if(!t)return void ee("Please enter Spreadsheet ID.");i={clientId:"109850791824-n46p4vttfogarvq9jq5k1uqibliu1ulv.apps.googleusercontent.com",spreadsheetId:t,sheetName:a},localStorage.setItem(r,JSON.stringify(i)),o="sheets",localStorage.setItem(n,o);try{l(),e?.store?.sourceStore?(await e.store.sourceStore._ensureAuthenticated(),er(E,"Configuration saved and signed in successfully!",!1),ep()):er(E,"Configuration saved successfully!",!1)}catch(e){console.error("Error during Google Sheets setup:",e),er(E,`Error: ${e.message}`,!0)}}async function eh(){try{e?.store?.sourceStore?.signOut&&await e.store.sourceStore.signOut(),er(E,"Signed out successfully!",!1),ep()}catch(e){console.error("Error signing out:",e),er(E,`Error signing out: ${e.message}`,!0)}}function ey(e){let t=e.target.value;h&&h.classList.add("hidden"),y&&y.classList.add("hidden"),"appsheet"===t&&h?h.classList.remove("hidden"):"sheets"===t&&y&&y.classList.remove("hidden"),"local"===t&&(o="local",localStorage.setItem(n,o),l(),er(u,"Switched to local storage",!1))}function ep(){if(!e?.store?.sourceStore)return;let t=e.store.sourceStore.isSignedIn?.()||!1;b&&(t?b.classList.remove("hidden"):b.classList.add("hidden"))}async function ef(t=!1){if(Y&&J&&U&&e){Y.innerHTML='<div class="col-span-7 text-center py-4">Loading calendar...</div>',J.innerHTML='<div class="col-span-7 text-center py-4">Loading calendar...</div>',U.innerHTML='<div class="col-span-7 text-center py-4">Loading calendar...</div>';try{t?await e.refreshFromSource():await e.fetchAndProcessEntries(),ev(q,Z),eb()}catch(t){console.error("Failed to initialize calendar:",t);let e='<p class="text-red-500 col-span-7 text-center py-4">Could not load calendar data. Please try again later.</p>';Y&&(Y.innerHTML=e),J&&(J.innerHTML=e),U&&(U.innerHTML=e)}}}function ev(e,t){eE(e,t,Y,j);let n=t-1,r=e;n<0&&(n=11,r--),eE(r,n,J,W);let a=n-1,o=r;a<0&&(a=11,o--),eE(o,a,U,P);let i=["January","February","March","April","May","June","July","August","September","October","November","December"];R.textContent=`${i[a]} ${o} - ${i[t]} ${e}`,eb()}function eb(){let e=document.getElementById("next-month"),t=new Date,n=t.getMonth(),r=t.getFullYear();Z===n&&q===r?(e.classList.add("opacity-50","cursor-not-allowed"),e.classList.remove("cursor-pointer","hover:bg-gray-100"),e.setAttribute("disabled","disabled")):(e.classList.remove("opacity-50","cursor-not-allowed","disabled"),e.classList.add("cursor-pointer","hover:bg-gray-100"),e.removeAttribute("disabled"))}function eE(t,n,r,a){if(!r||!a)return;let o=new Date(t,n+1,0).getDate(),i=new Date(t,n,1).getDay();for(let e of(r.innerHTML="",["Sun","Mon","Tue","Wed","Thu","Fri","Sat"])){let t=document.createElement("div");t.className="calendar-header-day",t.textContent=e,r.appendChild(t)}a.textContent=`${["January","February","March","April","May","June","July","August","September","October","November","December"][n]} ${t}`;for(let e=0;e<i;e++){let e=document.createElement("div");e.className="border border-gray-100",r.appendChild(e)}let l=new Date;l.setHours(0,0,0,0),new Date(l).setDate(l.getDate()-l.getDay());for(let a=1;a<=o;a++){let o=document.createElement("div");o.className="text-center py-2 border border-gray-200 rounded hover:bg-blue-50 text-sm relative",o.textContent=a;let i=`${t}-${String(n+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`;i===`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`&&o.classList.add("bg-blue-50","font-bold");let s=e?e.migraineData.get(i):null,d="";s&&(d=s.map(e=>{let t=new Date(e.date).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return`${t}: ${e.notes||"No notes"}`}).join("\n")),s&&s.length>0?(o.classList.add("border-indigo-500","border-2","cursor-pointer"),o.setAttribute("title",d)):o.classList.add("cursor-default"),r.appendChild(o)}}function ew(){console.log("Starting renderDayOfWeekChart");let t=document.getElementById("day-of-week-chart-container"),n=document.getElementById("report-loading-message");if(!t)return void console.error("Chart container element not found.");if(!e)return void console.error("MigraineApp not initialized");console.log("migraineData size:",e.migraineData.size),console.log("migraineData entries:",Array.from(e.migraineData.entries()).slice(0,3));let r=t.querySelector("canvas");r&&(console.log("Removing existing canvas"),r.remove()),G&&(console.log("Destroying previous chart instance"),G.destroy(),G=null);let a=Array(7).fill(0);console.log("Processing migraine dates for day of week histogram (local time):");let o=0;e.migraineData.forEach((e,t)=>{e.forEach(e=>{try{if(e&&e.date){let t=new Date(e.date);if(isNaN(t.getTime()))console.error(`Invalid Date object from entry.date: ${e.date} in renderDayOfWeekChart`);else{let e=t.getDay();a[e]++,o++}}else console.error("Migraine entry or entry.date is undefined in renderDayOfWeekChart:",e)}catch(t){console.error(`Error processing individual entry for day of week chart: ${e?e.date:"undefined entry"}`,t)}})}),console.log("Final day counts (local):",a),console.log("Total count (local):",o),console.log("Creating new canvas");let i=document.createElement("canvas");i.id="day-of-week-chart",t.appendChild(i);let l=i.getContext("2d");if(!l)return void console.error("Failed to get 2D context from new canvas.");if("undefined"==typeof Chart)return void console.error("Chart.js library not loaded");if(!a.some(e=>e>0)){console.log("No data to display in day of week chart"),n&&(n.textContent="No data to display. Try adding entries in the Log view.",n.classList.remove("hidden"));return}console.log("Creating chart with data:",{labels:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],data:a}),G=new Chart(l,{type:"bar",data:{labels:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],datasets:[{label:"Number of Migraines",data:a,backgroundColor:"rgba(79, 70, 229, 0.6)",borderColor:"rgba(79, 70, 229, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0}},x:{title:{display:!1,text:"Day of Week"}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),null!==e.parsed.y&&(t+=e.parsed.y),t}}}}}}),console.log("Chart created successfully")}function eL(e){let t=document.getElementById("days-between-chart"),n=document.getElementById("days-between-loading-message");if(!t)return void console.error("Days Between Chart canvas element not found.");let r=t.getContext("2d");if(!r){console.error("Failed to get 2D context from days-between-chart canvas."),n&&(n.textContent="Error: Chart canvas context failed.",n.classList.remove("hidden"));return}if(_&&_.destroy(),!e||0===e.length){r.clearRect(0,0,r.canvas.width,r.canvas.height),r.textAlign="center",r.font="14px Arial",r.fillStyle="grey",r.fillText("No day differences (1+ days) to display.",r.canvas.width/2,r.canvas.height/2),n&&n.classList.add("hidden");return}let a=[...e].sort((e,t)=>new Date(e.date)-new Date(t.date)),o=[];for(let e=1;e<a.length;e++){let t=new Date(a[e-1].date),n=new Date(a[e].date),r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),i=new Date(n.getFullYear(),n.getMonth(),n.getDate());if(isNaN(r.getTime())||isNaN(i.getTime())){console.warn(`Invalid date encountered after local normalization in daysBetweenChart: ${a[e-1].date} or ${a[e].date}`);continue}let l=Math.round((i.getTime()-r.getTime())/864e5);l>=1&&o.push(l)}if(0===o.length){console.log("No day differences (1+ days) calculated."),r.clearRect(0,0,r.canvas.width,r.canvas.height),r.textAlign="center",r.font="14px Arial",r.fillStyle="grey",r.fillText("No day differences (1+ days) to display.",r.canvas.width/2,r.canvas.height/2),n&&n.classList.add("hidden");return}let i=Array(10).fill(0),l=[];for(let e=1;e<10;e++)l.push(String(e));l.push("10+"),o.forEach(e=>{e>=10?i[9]++:i[e-1]++}),_=new Chart(r,{type:"bar",data:{labels:l,datasets:[{label:"Frequency",data:i,backgroundColor:"rgba(153, 102, 255, 0.6)",borderColor:"rgba(153, 102, 255, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!1,text:"Number of Occurrences"},ticks:{stepSize:1,precision:0}},x:{title:{display:!1,text:"Days Between Migraines"}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return`Occurrences: ${e.parsed.y}`}}}}}}),n&&n.classList.add("hidden"),console.log("Days Between Migraines chart created successfully")}function ex(e){let t=document.getElementById("monthlyMigraineChart")?.getContext("2d"),n=document.getElementById("report-loading-message");if(!t){console.error("Monthly Migraine chart canvas not found"),n&&(n.textContent="Error: Monthly Migraine chart canvas not found.",n.classList.remove("hidden"));return}if("undefined"==typeof Chart){console.error("Chart.js library not loaded for Monthly Migraine chart"),n&&(n.textContent="Error: Chart library not available for Monthly chart.",n.classList.remove("hidden"));return}if(K&&K.destroy(),!e||0===e.length){t.clearRect(0,0,t.canvas.width,t.canvas.height),t.textAlign="center",t.fillText("No data available",t.canvas.width/2,t.canvas.height/2);return}let r=[],a=new Date;a.setHours(0,0,0,0);for(let e=11;e>=0;e--){let t=new Date(a.getFullYear(),a.getMonth()-e,1),n=new Date(t.getFullYear(),t.getMonth(),1),o=new Date(t.getFullYear(),t.getMonth()+1,0,23,59,59,999),i=n.toLocaleDateString(void 0,{month:"short",year:"2-digit"});r.push({start:n,end:o,label:i,count:0})}e.forEach(e=>{let t=new Date(e.date);for(let e of r)if(t>=e.start&&t<=e.end){e.count++;break}}),K=new Chart(t,{type:"bar",data:{labels:r.map(e=>e.label),datasets:[{label:"Number of Migraines",data:r.map(e=>e.count),backgroundColor:"rgba(0, 123, 255, 0.6)",borderColor:"rgba(0, 123, 255, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return`Migraines: ${e.parsed.y}`}}}}}}),n&&n.classList.add("hidden")}X&&X.addEventListener("click",function(){Q&&Q.classList.add("hidden"),V&&(V.textContent="")}),$&&$.addEventListener("click",()=>ea("log")),T&&T.addEventListener("click",()=>ea("calendar")),N&&N.addEventListener("click",()=>ea("settings")),F&&F.addEventListener("click",()=>ea("report")),!function(){let e=document.querySelector(`input[name="storage-type"][value="${o}"]`);e&&(e.checked=!0,ey({target:e})),c&&(c.value=a),p&&(p.value=i.spreadsheetId||""),f&&(f.value=i.sheetName||"Sheet1"),ep()}(),C&&C.addEventListener("click",es),g&&g.addEventListener("click",function(){if(!c)return;let e=c.value.trim();e?(a=e,localStorage.setItem(t,a),o="appsheet",localStorage.setItem(n,o),l(),er(u,"URL saved successfully!",!1)):ee("Enter a valid URL.")}),v&&v.addEventListener("click",em),b&&b.addEventListener("click",eh),m.forEach(e=>{e.addEventListener("change",ey)}),s&&s.addEventListener("submit",eu),$&&ea("log",!1,!0),I&&I.addEventListener("click",t=>{let n=t.target.closest(".edit-btn"),r=t.target.closest(".delete-btn");if(n){let t=parseInt(n.dataset.id,10);t&&function(t){if(console.log("Edit clicked for ID:",t),!e)return ee("Error: App not initialized.");let n=e.historyDataCache.find(e=>e.rowId===t);if(!n){console.error("Entry data not found in cache for ID:",t),ee("Error: Could not find entry data to edit.");return}try{let e=new Date(n.date),t=6e4*e.getTimezoneOffset(),r=new Date(e.getTime()-t).toISOString().slice(0,16);w&&(w.value=r)}catch(e){console.error("Error parsing date for editing:",n.date,e),ee("Error: Could not parse date for editing."),w&&(w.value="")}L&&(L.value=n.notes),z=t,x&&(x.textContent="Update Entry"),S&&S.classList.remove("hidden"),ea("log",!0)}(t)}else if(r){let e=parseInt(r.dataset.id,10);e&&ec(e)}}),S&&S.addEventListener("click",eg),c&&(a?(c.value=a,er(u,"",!1)):er(u,"Save App Script URL",!1)),eo(),M&&B&&(M.classList.remove("hidden"),B.classList.add("hidden")),s&&s.addEventListener("submit",eu),H&&H.addEventListener("click",function(){--Z<0&&(Z=11,q--),ev(q,Z)}),O&&O.addEventListener("click",function(){let e=new Date,t=e.getMonth(),n=e.getFullYear();(Z!==t||q!==n)&&(++Z>11&&(Z=0,q++),(q>n||q===n&&Z>t)&&(Z=t,q=n),ev(q,Z))})});
//# sourceMappingURL=migraine-log.935c22ed.js.map
</script></head><body class="bg-gray-100 flex flex-col min-h-screen pb-16"> <main class="container flex-grow max-w-lg mx-auto p-4">   <section id="log-view" class="space-y-6 view-section">  <div class="bg-white mb-4 p-3 rounded-lg shadow"> <div class="flex items-center justify-center space-x-2"> <h3 class="font-semibold text-gray-700 text-md">Days Since Last Migraine:</h3> <span id="days-since-last-migraine" class="font-bold text-3xl text-indigo-600">--</span> </div> </div> <form id="migraine-form" class="bg-white p-6 rounded-lg shadow-md"> <div class="space-y-4"> <div> <input type="datetime-local" id="migraine-datetime" name="datetime" required class="block border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 p-2 rounded-md shadow-sm text-sm w-full"> </div> <div> <textarea id="notes" name="notes" rows="2" class="block border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 p-2 rounded-md shadow-sm text-sm w-full" placeholder="Details..."></textarea> </div> <input type="hidden" id="edit-id" name="edit-id"> <div class="flex space-x-2"> <button type="submit" id="save-entry-button" class="bg-indigo-600 border border-transparent flex focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 font-medium hover:bg-indigo-700 justify-center px-4 py-3 rounded-md shadow-sm text-sm text-white w-full"> New Entry </button> <button type="button" id="cancel-edit-button" class="bg-white border border-gray-300 flex focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 font-medium hidden hover:bg-gray-50 justify-center px-4 py-3 rounded-md shadow-sm text-gray-700 text-sm w-full"> Cancel </button> </div> </div> </form>  <div class="mt-8"> <div class="flex items-center justify-between mb-4"> <h2 class="font-bold text-gray-800 text-xl">Recent Entries</h2> <div class="flex items-center space-x-2"> <div id="last-updated" class="italic text-gray-500 text-xs"></div> <button id="refresh-history-button" class="bg-green-600 border border-transparent cursor-pointer disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 font-medium hover:bg-green-700 inline-flex items-center px-3 py-1 rounded-md shadow-sm text-sm text-white"> Refresh </button> </div> </div> <div id="history-content" class="bg-white p-4 rounded-lg shadow-md space-y-4">  <p class="text-center text-gray-500">Loading history...</p> </div> </div> </section>  <section id="settings-view" class="hidden space-y-6 view-section"> <h1 class="font-bold text-2xl text-center text-gray-800">Settings</h1>  <div class="bg-white p-6 rounded-lg shadow-md"> <h3 class="font-medium mb-4 text-gray-800 text-lg">Data Storage</h3> <div class="space-y-3"> <label class="flex items-center"> <input type="radio" name="storage-type" value="local" id="storage-local" class="mr-2"> <span class="text-gray-700 text-sm">Local Storage (Browser only)</span> </label> <label class="flex items-center"> <input type="radio" name="storage-type" value="appsheet" id="storage-appsheet" class="mr-2"> <span class="text-gray-700 text-sm">Google Apps Script (AppSheet)</span> </label> <label class="flex items-center"> <input type="radio" name="storage-type" value="sheets" id="storage-sheets" class="mr-2"> <span class="text-gray-700 text-sm">Google Sheets API</span> </label> </div> </div>  <div id="appsheet-config" class="bg-white hidden p-6 rounded-lg shadow-md"> <h3 class="font-medium mb-2 text-gray-800 text-lg">Google Apps Script Configuration</h3> <label for="script-url" class="block font-medium mb-1 text-gray-700 text-sm">Apps Script URL:</label> <div class="flex space-x-2"> <input type="url" id="script-url" placeholder="Paste deployed script URL here" class="block border-gray-300 flex-grow mt-1 p-2 rounded-md shadow-sm text-sm w-full"> <button id="save-appsheet-button" class="bg-white border border-gray-300 cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 font-medium hover:bg-gray-50 inline-flex items-center px-4 py-2 rounded-md shadow-sm text-gray-700 text-sm"> Save </button> </div> <p id="appsheet-status" class="h-4 mt-1 text-sm"></p> </div>  <div id="sheets-config" class="bg-white hidden p-6 rounded-lg shadow-md"> <h3 class="font-medium mb-2 text-gray-800 text-lg">Google Sheets API Configuration</h3> <div class="space-y-4"> <div> <label for="spreadsheet-id" class="block font-medium mb-1 text-gray-700 text-sm">Spreadsheet ID:</label> <input type="text" id="spreadsheet-id" placeholder="Google Sheets spreadsheet ID" class="block border-gray-300 mt-1 p-2 rounded-md shadow-sm text-sm w-full"> <p class="mt-1 text-gray-500 text-xs">Find this in your sheet URL: docs.google.com/spreadsheets/d/<strong>SPREADSHEET_ID</strong>/edit</p> </div> <div> <label for="sheet-name" class="block font-medium mb-1 text-gray-700 text-sm">Sheet Name:</label> <input type="text" id="sheet-name" placeholder="Sheet1" value="Sheet1" class="block border-gray-300 mt-1 p-2 rounded-md shadow-sm text-sm w-full"> </div> <div class="flex space-x-2"> <button id="save-sheets-button" class="bg-white border border-gray-300 cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 font-medium hover:bg-gray-50 inline-flex items-center px-4 py-2 rounded-md shadow-sm text-gray-700 text-sm"> Save &amp; Sign In </button> <button id="signout-sheets-button" class="bg-white border border-red-300 cursor-pointer focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 font-medium hidden hover:bg-red-50 inline-flex items-center px-4 py-2 rounded-md shadow-sm text-red-700 text-sm"> Sign Out </button> </div> <p id="sheets-status" class="h-4 mt-1 text-sm"></p> </div> </div> </section>  <section id="calendar-view" class="hidden space-y-4 view-section"> <div class="flex items-center justify-between"> <button id="prev-month" class="cursor-pointer hover:bg-gray-100 p-2 rounded-md text-gray-600"> <svg fill="none" stroke="currentColor" stroke-width="2" class="h-5 w-5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m15 19-7-7 7-7"/></svg> </button> <h2 id="current-month-year" class="font-semibold text-gray-800 text-lg"></h2> <button id="next-month" class="cursor-pointer hover:bg-gray-100 p-2 rounded-md text-gray-600"> <svg fill="none" stroke="currentColor" stroke-width="2" class="h-5 w-5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7"/></svg> </button> </div> <div class="flex flex-col gap-4">  <div class="bg-white p-4 rounded-lg shadow-md sm:p-6"> <h3 id="first-month-year" class="font-semibold mb-2 text-center text-gray-800 text-md"></h3> <div id="calendar-grid-1" class="calendar-grid mb-2">  <div class="calendar-header-day">Sun</div> <div class="calendar-header-day">Mon</div> <div class="calendar-header-day">Tue</div> <div class="calendar-header-day">Wed</div> <div class="calendar-header-day">Thu</div> <div class="calendar-header-day">Fri</div> <div class="calendar-header-day">Sat</div>  </div> </div>  <div class="bg-white p-4 rounded-lg shadow-md sm:p-6"> <h3 id="second-month-year" class="font-semibold mb-2 text-center text-gray-800 text-md"></h3> <div id="calendar-grid-2" class="calendar-grid mb-2">  <div class="calendar-header-day">Sun</div> <div class="calendar-header-day">Mon</div> <div class="calendar-header-day">Tue</div> <div class="calendar-header-day">Wed</div> <div class="calendar-header-day">Thu</div> <div class="calendar-header-day">Fri</div> <div class="calendar-header-day">Sat</div>  </div> </div>  <div class="bg-white p-4 rounded-lg shadow-md sm:p-6"> <h3 id="third-month-year" class="font-semibold mb-2 text-center text-gray-800 text-md"></h3> <div id="calendar-grid-3" class="calendar-grid mb-2">  <div class="calendar-header-day">Sun</div> <div class="calendar-header-day">Mon</div> <div class="calendar-header-day">Tue</div> <div class="calendar-header-day">Wed</div> <div class="calendar-header-day">Thu</div> <div class="calendar-header-day">Fri</div> <div class="calendar-header-day">Sat</div>  </div> </div> </div> </section>  <section id="report-view" class="hidden space-y-6 view-section"> <div class="bg-white p-4 rounded-lg shadow"> <h3 class="font-medium mb-3 text-center text-gray-700 text-lg">Migraines per Month (Last 12 Months)</h3> <div class="h-64 md:h-80 relative sm:h-72"> <canvas id="monthlyMigraineChart"></canvas> </div> </div> <div class="bg-white p-6 rounded-lg shadow-md"> <h3 class="font-medium mb-4 text-center text-gray-800 text-lg">Migraines by Day of Week</h3> <div id="day-of-week-chart-container" class="h-64 relative w-full">  <p id="report-loading-message" class="absolute flex inset-0 items-center justify-center text-center text-gray-500">Loading report...</p> </div> </div> <div class="bg-white p-6 rounded-lg shadow-md"> <h3 class="font-medium mb-4 text-center text-gray-800 text-lg">Days Between Migraines</h3> <div id="days-between-chart-container" class="h-64 relative w-full"> <canvas id="days-between-chart"></canvas> <p id="days-between-loading-message" class="absolute flex inset-0 items-center justify-center text-center text-gray-500">Loading report...</p> </div> </div> </section> </main>  <nav class="bg-white border-gray-200 border-t bottom-0 fixed flex h-16 items-center justify-around left-0 right-0 shadow-md z-10"> <button id="log-nav-button" class="cursor-pointer flex flex-col hover:text-indigo-600 items-center justify-center pb-1 pt-2 text-gray-600 w-full">  <svg fill="none" stroke="currentColor" stroke-width="2" class="h-6 w-6" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2v-5m-1.414-9.414a2 2 0 1 1 2.828 2.828L11.828 15H9v-2.828z"/></svg> <span class="mt-1 text-xs">Log</span> </button> <button id="calendar-nav-button" class="cursor-pointer flex flex-col hover:text-indigo-600 items-center justify-center pb-1 pt-2 text-gray-600 w-full"> <svg fill="none" stroke="currentColor" stroke-width="2" class="h-6 w-6" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2"/></svg> <span class="mt-1 text-xs">Calendar</span> </button> <button id="report-nav-button" class="cursor-pointer flex flex-col hover:text-indigo-600 items-center justify-center pb-1 pt-2 text-gray-600 w-full"> <svg fill="none" stroke="currentColor" stroke-width="2" class="h-6 w-6" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2m0 0V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v10m-6 0a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2m0 0V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2"/></svg> <span class="mt-1 text-xs">Report</span> </button> <button id="settings-nav-button" class="cursor-pointer flex flex-col hover:text-indigo-600 items-center justify-center pb-1 pt-2 text-gray-600 w-full"> <svg fill="none" stroke="currentColor" stroke-width="1.5" class="h-6 w-6" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87q.11.06.22.127c.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.8 6.8 0 0 1 0 1.255c-.007.378.138.75.43.99l1.005.828c.428.355.532.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a7 7 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.063-.374-.313-.686-.644-.87a7 7 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a7 7 0 0 1 0-1.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124q.108-.066.22-.128c.332-.183.582-.495.644-.869z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/></svg> <span class="mt-1 text-xs">Settings</span> </button> </nav>  <svg style="display:none"><symbol id="icon-edit" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"/></symbol><symbol id="icon-delete" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21q.512.078 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48 48 0 0 0-3.478-.397m-12 .562q.51-.089 1.022-.165m0 0a48 48 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a52 52 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a49 49 0 0 0-7.5 0"/></symbol></svg>  <div id="error-modal" class="bg-gray-600 bg-opacity-50 fixed flex h-full hidden inset-0 items-center justify-center overflow-y-auto w-full z-50"> <div class="bg-white border max-w-md mx-auto p-5 relative rounded-md shadow-lg w-11/12"> <div class="mt-3 text-center"> <div class="bg-red-100 flex h-12 items-center justify-center mx-auto rounded-full w-12"> <svg fill="none" stroke="currentColor" stroke-width="1.5" class="h-6 text-red-600 w-6" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0zM12 15.75h.007v.008H12z"/></svg> </div> <h3 class="font-medium leading-6 mt-2 text-gray-900 text-lg">Error</h3> <div class="mt-2 px-7 py-3"> <p id="error-message" class="text-gray-500 text-sm">  </p> </div> <div class="items-center px-4 py-3"> <button id="close-error-modal-button" class="bg-red-500 focus:outline-none focus:ring-2 focus:ring-red-300 font-medium hover:bg-red-600 px-4 py-2 rounded-md shadow-sm text-base text-white w-full"> OK </button> </div> </div> </div> </div> </body></html>